<!DOCTYPE html>
<html lang="en">
<head>
    <title>BankSystem : Start</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
</head>
<body>
<form style="height:420px;" id=indexForm">
    <div id="toasts"></div>
    <h1 style="text-align: start">Balance</h1>
    <h2 id="balance"></h2>
    <button style="margin-top: 20px" id="sendMoneyButton">Transfer Money</button>
    <button style="margin-top: 20px" id="depositButton">Deposit Money</button>
    <button style="margin-top: 20px" id="transactionButton">My Transactions</button>
    <br><br>
    <div class="register">
        <h4>Done? <a href="/logout">Logout</a></h4>
    </div>
</form>

<div style="visibility: hidden" id="adminPanel">
    <form style="height:80px; margin-top: 260px">
        <button style=" padding: 10px;margin-top: -100px;margin-inline: 0" id="adminButton">Admin Panel</button>
    </form>
</div>

</body>
<script>
    document.addEventListener("DOMContentLoaded", function(){

        const balanceField = document.getElementById("balance")
        const adminPanel = document.getElementById("adminPanel")
        const xmlhttp = new XMLHttpRequest();

        xmlhttp.open("GET", "http://localhost:7070/get_balance");

        xmlhttp.onload = function() {
            if (xmlhttp.readyState !== XMLHttpRequest.DONE) {
                return;
            }
            if (xmlhttp.status >= 200 && xmlhttp.status < 300) {

                console.log("Result: " + xmlhttp.responseText);

                let response = xmlhttp.responseText.split(":");

                if(response[1] === "ROLE_ADMIN"){
                    adminPanel.style.visibility = "visible";
                }
                if(response[0] === "NOT_LOGGED_IN"){
                    window.location.replace("http://localhost:7070/login");
                }
                balanceField.innerHTML = response[0];
            }
            else {
                console.error("Request failed: ", xmlhttp.status);
            }
        };
        xmlhttp.send();

        const adminButton =
            document.getElementById("adminButton");

        document.getElementById("sendMoneyButton").addEventListener("click", event => {
            event.preventDefault();
            window.location.replace("http://localhost:7070/transfer");
        });
        document.getElementById("depositButton").addEventListener("click", event => {
            event.preventDefault();
            window.location.replace("http://localhost:7070/deposit");
        });
        document.getElementById("transactionButton").addEventListener("click", event => {
            event.preventDefault();
            window.location.replace("http://localhost:7070/transactions");
        });
        adminButton.addEventListener("click", event => {
            event.preventDefault();
            window.location.replace("http://localhost:7070/admin");
        });
    });
</script>
</html>

